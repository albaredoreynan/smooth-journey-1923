<div class="left"> 
<h2><a href="#">SALES BY SERVER</a></h2>
<hr/>
<br/>
<% form_tag :sales_by_server do %>
<table width="500" border="0">
  <tr>
	<td>From:</td>
	<td><%= date_select(:from, '', :start_year => 2000) %></td>
	<td><%= label_tag :restaurant %></td>
	<td><%= collection_select(:restaurant, :restaurant_name, Restaurant.all, :id, :restaurant_name, :prompt => true) %></td>
  </tr>
  <tr>
	<td>To:</td>
	<td><%= date_select(:to, '', :start_year => 2000) %></td>
	<td><%= label_tag :branch %></td>
	<td><%= collection_select(:branch, :branch_location, Branch.all, :id, :branch_location, :prompt => true) %></td>
  </tr>
  <tr>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
  </tr>
  <tr>
	<td><b>Server:</b></td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
  </tr>
  <tr>
	<td>&nbsp;</td>
	<td><%= collection_select(:employee, :employee_id, Employee.all, :id, :name_with_initial, :prompt => true) %></td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
  </tr>
	<tr>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td>&nbsp;</td>
	<td><%= submit_tag :Search %></td>
  </tr>
  <% end %>

</table>
<br/>
</div>

<div class="right">
<strong>Change View: </strong>
<br />
<!--
<select>
  <option>Sales by Category</option>
  <option>Sales by Settlement Type</option>
  <option>Sales by Server:</option>
  <option>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Category</option>
  <option>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Settlement Type</option>
</select>-->
<%= link_to 'Sales by Category Type', sales_path %><br />
<%= link_to 'Sales by Settlement Type', sales_by_settlement_type_path %><br />
<%= link_to 'Sales by Server', sales_by_server_path %>
</div>
<div style="clear:both;"></div>

<hr />
<h2><a href="#">Listing Sales by Server</a></h2>

<br/>


<% totalst = Hash.new %>
<table border="1" width="1000">
  <tr>
  	<th></th>
	<th>Date</th>
	<th>Server Name</th>
 	<% @settlement_types.each do |settlementtype|%>
	<th><%= settlementtype.st_name %></th>
	<% totalst = Hash[settlementtype.id => 0]%>
	<% end %>
	<th>VOIDS</th>
	<th>GROSS TOTAL</th>
	<th>NET TOTAL</th>
	<th></th>
  </tr>

<% totalvoid = 0  %>
<% totalgross   = 0  %>
<% totalnet  = 0  %>

<%= form_tag '/sales/savemultiple' do%>

<% @sales.each do |sale| %>
	<tr>
	<td><% if sale.save_as_draft == 1 %>
    	<center><%= check_box_tag "sale_ids[]", sale.id%><center>
    	<% end %></td>
	<td><%= sale.date.strftime("%b %d, %Y") %></td>
	<td><%= sale.employee.employee_firstName %></td>
	<%  sale.ssrows.each do |ss| %>
		<td><%= number_to_currency(ss.ss_amount, :precision => 2, :unit => " ") %></td>
		<% totalst[ss.settlement_type_id] = totalst[ss.settlement_type_id].to_f + ss.ss_amount %>
	<% end %>
	<td><%= number_to_currency(sale.void, :precision => 2, :unit => " ") %></td>
	<% totalvoid = totalvoid + sale.void  %>
	<td><%= number_to_currency(sale.gross_total_ss, :precision => 2, :unit => " ") %></td>
	<% totalgross = totalgross + sale.gross_total_ss  %>
	<td><%= number_to_currency(sale.net_total_ss, :precision => 2, :unit => " ") %></td>
	<% totalnet  = totalnet + sale.net_total_ss  %>
	<td><% if sale.save_as_draft == 1 %>
    	<%= link_to "Edit", edit_sale_path(sale) %>
    	<% end %></td>
  </tr>
<% end %>
  <tr>
  	<td></td>
	<td><center><b>TOTAL</b></center></td>
	<td>&nbsp;</td>
	<% @settlement_types.each do |settlementtype| %>
	<td><%= number_to_currency(totalst[settlementtype.id], :precision => 2, :unit => " ") %></td>
  	<% end %>
  	<td><%= number_to_currency(totalvoid, :precision => 2, :unit => " ") %></td>
  	<td><%= number_to_currency(totalgross, :precision => 2, :unit => " ") %></td>
  	<td><%= number_to_currency(totalnet, :precision => 2, :unit => " ") %></td>
  	<td></td>
  </tr>
</table>
<br />

<%= submit_tag 'Submit records'%> 
<% end %>
<%= link_to 'New Sale', new_sale_path %>

